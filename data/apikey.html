<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>OpenWeather API Key Setup</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- Google Font for title -->
        <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
        <style>body { background-color: #121212; color: #e0e0e0; } .card { background-color: #1e1e1e; border: 1px solid #333; } .card-title { font-family: 'Orbitron', sans-serif; } #statusMsg { margin-top: 10px; font-weight: bold; }</style>
    </head>
    <body>
        <div class="container py-5">
            <h1 class="text-center mb-4">Weather API Configurator</h1>
            <img src="https://openweathermap.org/themes/openweathermap/assets/img/logo_white_cropped.png" class="d-block mx-auto" alt="OpenWeather Logo" width="200">
            <!-- OpenWeather API Key Section -->
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <div class="card text-white">
                        <div class="card-body">
                            <h5 class="card-title">üå§Ô∏è OpenWeather API Key</h5>
                            <p class="card-text">
                        To use weather features you need a free API key: </p>
                            <ol>
                                <li>Go to <a href="https://home.openweathermap.org/users/sign_up" target="_blank">OpenWeather Sign Up</a>.
                                </li>
                                <li>Create a free account or log in.</li>
                                <li>Open your dashboard and go to the <strong>API keys</strong> tab.
                                </li>
                                <li>Copy your default key (or generate a new one) and paste it below.</li>
                            </ol>
                            <div class="alert alert-warning mt-3" role="alert" style="background-color:#332b00;color:#ffcc00;border:1px solid #665500;">
                                ‚ö†Ô∏è <strong>Important:</strong> Your OpenWeather API key is personal.
                                Do not share it publicly. Free keys have limited daily calls, and if
                                your key is abused the service may block or suspend it.
                            </div>
                            <div class="input-group mt-3">
                                <input type="text" class="form-control" id="apiKeyInput" placeholder="Enter your OpenWeather API key" aria-label="API Key"><span class="input-group-text">üîë</span>
                            </div>
                            <div id="statusMsg"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Bootstrap JS bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
    document.addEventListener("DOMContentLoaded", function () {
        const input = document.getElementById("apiKeyInput");
        const statusMsg = document.getElementById("statusMsg");

        // Load saved key from ESP
        fetch("/getApiKey")
            .then(r => r.text())
            .then(key => {
                if (key && key !== "null") input.value = key;
            })
            .catch(() => {
                statusMsg.innerText = "‚ö†Ô∏è Could not load saved key";
                statusMsg.classList.add("text-warning");
            });

        // Save on Enter key
        // Save on Enter key
        input.addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                fetch("/saveApiKey?key=" + encodeURIComponent(input.value))
                    .then(r => r.text())
                    .then(msg => {
                        // Show green toast instead of statusMsg
                        const toastEl = document.getElementById('saveSuccessToast');
                        const toast = new bootstrap.Toast(toastEl, { delay: 6000 });
                        toast.show();

                        // After toast finishes, redirect to index.html
                        setTimeout(() => {
                            window.location.href = "/";
                        }, 2500);
                    })
                    .catch(() => {
                        statusMsg.innerText = "‚ùå Error saving key";
                        statusMsg.classList.remove("text-warning", "text-success");
                        statusMsg.classList.add("text-danger");
                    });
            }
        });

    });
</script>
        <div class="position-fixed top-50 start-50 translate-middle p-3" style="z-index: 1100">
            <div id="saveSuccessToast" class="align-items-center border-0 text-bg-success toast " role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body" style="font-family:'Orbitron',sans-serif;font-size:18px;text-align:center;">
                        ‚úÖ API Key saved successfully!<br>
                        Adapt your coordinates<br>
                        (latitude & longitude)
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
